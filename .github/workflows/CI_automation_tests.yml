name: CI - Automation (Sanity & Regression)

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  sanity-tests:
    name: ğŸ§ª Sanity Tests
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
    - name: â¬‡ï¸ Checkout Repository
      uses: actions/checkout@v4

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ğŸ­ Install Playwright Browsers
      run: |
        playwright install chromium
        playwright install-deps chromium

    - name: ğŸ§ª Run Sanity Tests
      run: |
        echo "Running sanity tests..."
        mkdir -p Artifacts/Reports
        pytest tests/saucedemo/test_login.py -v --html=Artifacts/Reports/sanity_report.html --self-contained-html

    - name: ğŸ“¤ Upload Sanity Test Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: Sanity-Test-Report
        path: Artifacts/Reports/sanity_report.html
        if-no-files-found: ignore

    - name: ğŸ“Š Sanity Test Summary
      if: always()
      run: |
        echo "âœ… Sanity tests completed"

  regression-tests:
    name: ğŸ”„ Regression Tests
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: â¬‡ï¸ Checkout Repository
      uses: actions/checkout@v4

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ğŸ­ Install Playwright Browsers
      run: |
        playwright install chromium
        playwright install-deps chromium

    - name: ğŸ”„ Run Regression Tests
      run: |
        echo "Running regression tests..."
        mkdir -p Artifacts/Reports
        pytest tests/ -v --html=Artifacts/Reports/regression_report.html --self-contained-html

    - name: ğŸ“¤ Upload Regression Test Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: Regression-Test-Report
        path: Artifacts/Reports/regression_report.html
        if-no-files-found: ignore

    - name: ğŸ“Š Regression Test Summary
      if: always()
      run: |
        echo "âœ… Regression tests completed"

  code-quality:
    name: ğŸ“ Code Quality Checks
    runs-on: ubuntu-latest

    steps:
    - name: â¬‡ï¸ Checkout Repository
      uses: actions/checkout@v4

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: ğŸ“¦ Install Linters
      run: |
        pip install flake8 pylint

    - name: ğŸ” Run Flake8
      run: |
        flake8 pages/ tests/ --count --select=E9,F63,F7,F82 --show-source --statistics || true
        flake8 pages/ tests/ --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics || true

    - name: ğŸ” Run Pylint
      run: |
        pylint pages/*.py tests/**/*.py --disable=all --enable=E,F || true

    - name: âœ… Code Quality Summary
      if: always()
      run: |
        echo "âœ… Code quality checks completed"

